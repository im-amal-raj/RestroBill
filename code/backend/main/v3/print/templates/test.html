<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill</title>
</head>
<body>
    <button id="generate-bill">Generate Bill</button>
</body>
    <script>
        function formatDateTime() {
          const now = new Date();
          // Choose appropriate date/time format
          return now.toLocaleString(); // Adjust format based on your needs
        }

    const generateBillBtn = document.getElementById('generate-bill');
    generateBillBtn.addEventListener('click', function() {
      // Fetch bill data from backend (assuming it's already available)
      const cart = JSON.parse(/* your logic to get cart data */);

      // Process and structure bill data
      const billItems = []; // Assuming array of objects for each item
      for (const key in cart.list) {
        billItems.push({
          no: parseInt(key) + 1,
          product: cart.list[key].product,
          qty: cart.list[key].qty,
          mrp: cart.list[key].mrp,
          price: cart.list[key].price,
        });
      }

      // Create bill HTML dynamically
      let billHtml = `<!DOCTYPE html>
        <html lang="en">
          <head>
            <meta charset="UTF-8">
            <title>Bill</title>
            <style>
              /* Same CSS styles from your bill-template.html */
            </style>
          </head>
          <body>`;

      billHtml += `
        <div class="bill">
          ...
        </div>`;

      // Fill in bill content using processed data and cart values
      billHtml = billHtml.replace(/{{ loop.index }}/g, (match, index) => billItems[index].no); // Replace item numbers
      for (const item of billItems) {
        billHtml = billHtml.replace(/{{ item.product }}/g, item.product);
        billHtml = billHtml.replace(/{{ item.qty }}/g, item.qty);
        billHtml = billHtml.replace(/{{ item.mrp }}/g, item.mrp);
        billHtml = billHtml.replace(/{{ item.price }}/g, item.price);
      }
      billHtml += `
          <h4 class="mar-b-10">
            <span>Total amount : â‚¹${cart.payment.total}</span>
          </h4>
          </div>
      </body>
    </html>`;

      // Open the bill in a new tab or window
      const newWindow = window.open('', '_blank');
      newWindow.document.write(billHtml);
      newWindow.document.close(); // Ensure content is fully loaded before closing
    });
    </script>
</html>
